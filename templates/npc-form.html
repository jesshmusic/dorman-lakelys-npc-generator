<div class="npc-generator-form">
    <!-- Instructions -->
    <div class="instructions">
        <p><strong>How to use:</strong> Drop an actor as a template → Adjust Species, Alignment, and CR → Fill in Name/Bio {{#if aiEnabled}}or use AI generation{{/if}}</p>
    </div>

    <!-- Template Actor Drop Zone -->
    <div class="drop-zone" data-drop="actor">
        <div class="drop-zone-content">
            <i class="fas fa-user-plus fa-3x"></i>
            <p class="drop-zone-label">Drop Template Actor Here <span class="required">*</span></p>
            <p class="drop-zone-hint">Drag an actor from the sidebar to use as a template (stats will be copied)</p>
        </div>
        <div class="dropped-actors" style="display: none;">
            <!-- Dropped actor thumbnail will be added here -->
        </div>
    </div>

    <div class="form-group">
        <label for="npc-destination">Destination</label>
        <select id="npc-destination" name="destination">
            <option value="world">Create as World Actor</option>
            <option value="new-compendium">Create New Compendium</option>
            {{#if compendiums.length}}
            <optgroup label="Existing Compendiums">
                {{#each compendiums}}
                <option value="compendium:{{this.id}}">{{this.title}}</option>
                {{/each}}
            </optgroup>
            {{/if}}
        </select>
    </div>

    <div class="form-group" id="new-compendium-name-group" style="display: none;">
        <label for="new-compendium-name">Compendium Name <span class="required">*</span></label>
        <input type="text" id="new-compendium-name" name="newCompendiumName" placeholder="Enter compendium name" />
    </div>

    <div class="form-group" id="folder-select-group">
        <label for="npc-folder">Folder</label>
        <select id="npc-folder" name="folder">
            <option value="">None (Root)</option>
            {{#if folders.length}}
                {{#each folders}}
                <option value="{{this.id}}">{{this.name}}</option>
                {{/each}}
            {{/if}}
        </select>
    </div>

    <!-- Species Drop Zone -->
    <div class="form-group">
        <label>Species (Optional)</label>
        <div class="drop-zone" data-drop="species">
            <div class="drop-zone-content">
                <i class="fas fa-dragon fa-2x"></i>
                <p class="drop-zone-label">Drop Species Item Here</p>
                <p class="drop-zone-hint">Drag a species/race item to use its type and traits</p>
            </div>
            <div class="dropped-species" style="display: none;">
                <!-- Dropped species thumbnail will be added here -->
            </div>
        </div>
    </div>

    <!-- Actor Type Dropdown (shown if no species dropped) -->
    <div class="form-group" id="actor-type-group">
        <label for="npc-actor-type">Creature Type</label>
        <select id="npc-actor-type" name="actorType">
            <option value="aberration">Aberration</option>
            <option value="beast">Beast</option>
            <option value="celestial">Celestial</option>
            <option value="construct">Construct</option>
            <option value="dragon">Dragon</option>
            <option value="elemental">Elemental</option>
            <option value="fey">Fey</option>
            <option value="fiend">Fiend</option>
            <option value="giant">Giant</option>
            <option value="humanoid" selected>Humanoid</option>
            <option value="monstrosity">Monstrosity</option>
            <option value="ooze">Ooze</option>
            <option value="plant">Plant</option>
            <option value="undead">Undead</option>
        </select>
    </div>

    <div class="form-group">
        <label for="npc-alignment">Alignment</label>
        <select id="npc-alignment" name="alignment">
            {{#each alignments}}
            <option value="{{this}}">{{this}}</option>
            {{/each}}
        </select>
    </div>

    <div class="form-group">
        <label for="npc-cr">Challenge Rating</label>
        <div class="cr-select-wrapper">
            <select id="npc-cr" name="challengeRating">
                {{#each challengeRatings}}
                <option value="{{this}}">{{this}}</option>
                {{/each}}
            </select>
            <span id="cr-change-indicator" class="cr-change-indicator" style="display: none;"></span>
        </div>
    </div>


    <div class="form-group">
        <label for="npc-name">Name <span class="required">*</span></label>
        <div class="input-with-ai">
            <input type="text" id="npc-name" name="name" placeholder="Enter NPC name" required />
            {{#if aiEnabled}}
            <button type="button" class="ai-assist-btn" data-ai-action="generateName" title="Generate Name">
                <i class="fas fa-rotate"></i>
            </button>
            {{/if}}
        </div>
    </div>

    <div class="form-group">
        <label for="npc-description">Biography <span class="required">*</span></label>
        <div class="input-with-ai">
            <textarea id="npc-description" name="description" rows="6" placeholder="Enter NPC biography" required></textarea>
            {{#if aiEnabled}}
            <button type="button" class="ai-assist-btn" data-ai-action="generateBio" title="Generate Biography">
                <i class="fas fa-rotate"></i>
            </button>
            {{/if}}
        </div>
    </div>

    <!-- Portrait and Token Fields -->
    <div class="form-group image-fields">
        <div class="image-field">
            <label for="npc-portrait">Portrait</label>
            <div class="image-input-group">
                <input type="text" id="npc-portrait" name="portrait" placeholder="Path to portrait image" />
                <button type="button" class="file-picker" data-target="portrait" data-type="imagevideo" title="Browse Files">
                    <i class="fas fa-file-image"></i>
                </button>
            </div>
            <div class="image-preview" data-preview="portrait">
                <img src="" alt="Portrait Preview" style="display: none;" />
            </div>
        </div>
        <div class="image-field">
            <label for="npc-token">Token</label>
            <div class="image-input-group">
                <input type="text" id="npc-token" name="token" placeholder="Path to token image" />
                <button type="button" class="file-picker" data-target="token" data-type="imagevideo" title="Browse Files">
                    <i class="fas fa-file-image"></i>
                </button>
            </div>
            <div class="image-preview" data-preview="token">
                <img src="" alt="Token Preview" style="display: none;" />
            </div>
        </div>
    </div>

    <footer class="form-footer flexrow">
        <button type="button" data-action="create" class="bright">
            <i class="fas fa-check"></i> Create NPC
        </button>
        <button type="button" data-action="cancel">
            <i class="fas fa-times"></i> Cancel
        </button>
    </footer>
</div>
