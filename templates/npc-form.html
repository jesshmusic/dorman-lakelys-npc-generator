<div class="npc-generator-form">
    <!-- Instructions -->
    <div class="instructions">
        <p><strong>Quick NPC Generator:</strong> Fill in the basic details below and {{#if aiEnabled}}use AI to{{else}}manually{{/if}} create your NPC</p>
    </div>

    <!-- Patreon Status Header -->
    <div class="patreon-status-header">
        {{#if patreonAuthenticated}}
            <div class="patreon-connected">
                <span class="patreon-tier-badge {{patreonTier}}" title="Click to manage Patreon connection">
                    <i class="fab fa-patreon"></i> {{patreonTierDisplay}}
                </span>
                <span class="patreon-features-hint">AI features unlocked</span>
            </div>
        {{else}}
            <div class="patreon-not-connected">
                <button type="button" class="patreon-connect-btn" data-action="connect-patreon">
                    <i class="fab fa-patreon"></i> Connect Patreon for AI Features
                </button>
                <p class="patreon-hint">Unlock AI name generation, biographies, and portraits with a Patreon membership</p>
            </div>
        {{/if}}
    </div>

    <!-- Folder Selection -->
    <div class="form-group" id="folder-select-group">
        <label for="npc-folder">Folder (Optional)</label>
        <select id="npc-folder" name="folder">
            <option value="">-- No Folder --</option>
            {{#each folders}}
            <option value="{{this.id}}">{{this.name}}</option>
            {{/each}}
        </select>
    </div>

    <!-- Flavor -->
    <div class="form-group">
        <label for="npc-flavor">Campaign Flavor</label>
        <select id="npc-flavor" name="flavor">
            <option value="">-- Select Flavor (Optional) --</option>
            {{#each flavors}}
            <option value="{{this}}">{{this}}</option>
            {{/each}}
        </select>
    </div>

    <!-- Species -->
    <div class="form-group">
        <label for="npc-species">Species</label>
        <select id="npc-species" name="species">
            {{#each species}}
            <option value="{{this}}">{{this}}</option>
            {{/each}}
        </select>
    </div>

    <!-- Gender -->
    <div class="form-group">
        <label for="npc-gender">Gender</label>
        <select id="npc-gender" name="gender">
            <option value="">-- Select Gender (Optional) --</option>
            {{#each genders}}
            <option value="{{this}}">{{this}}</option>
            {{/each}}
        </select>
    </div>

    <!-- Role -->
    <div class="form-group">
        <label for="npc-role">Role</label>
        <select id="npc-role" name="role">
            {{#each roles}}
            <option value="{{this}}">{{this}}</option>
            {{/each}}
        </select>
    </div>

    <!-- Name -->
    <div class="form-group">
        <label for="npc-name">
            Name <span class="required">*</span>
            {{#unless hasNameGeneration}}
                <span class="feature-badge apprentice" title="Requires Apprentice tier or higher">
                    <i class="fas fa-lock"></i> Apprentice
                </span>
            {{/unless}}
        </label>
        <div class="input-with-ai">
            <input type="text" id="npc-name" name="name" placeholder="Enter NPC name" required />
            {{#if aiEnabled}}
            <button type="button" class="ai-assist-btn {{#unless hasNameGeneration}}locked{{/unless}}" data-ai-action="generateName" title="{{#if hasNameGeneration}}Generate Name{{else}}Requires Apprentice tier{{/if}}">
                <i class="fas fa-wand-magic-sparkles"></i>
            </button>
            {{/if}}
        </div>
    </div>

    <!-- Alignment -->
    <div class="form-group">
        <label for="npc-alignment">Alignment</label>
        <select id="npc-alignment" name="alignment">
            {{#each alignments}}
            <option value="{{this}}">{{this}}</option>
            {{/each}}
        </select>
    </div>

    <!-- CR Slider -->
    <div class="form-group">
        <label for="npc-cr">Challenge Rating: <span id="cr-value">1</span></label>
        <input type="range" id="npc-cr" name="challengeRating" min="0" max="30" value="5" step="1" />
    </div>

    <!-- Personality -->
    <div class="form-group">
        <label>Personality Traits</label>
        <input type="hidden" id="npc-personality" name="personality" value="" />
        <div class="multiple-dropdown-select">
            <div class="multiple-dropdown flexrow">
                <div class="multiple-dropdown-content" id="personality-selected">
                    <!-- Selected traits appear here as pills -->
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
            <ul class="dropdown-list">
                {{#each personalities}}
                <li class="multiple-dropdown-item" data-value="{{this}}">
                    {{this}}
                </li>
                {{/each}}
            </ul>
        </div>
    </div>

    <!-- Biography -->
    <div class="form-group">
        <label for="npc-biography">
            Biography
            {{#unless hasBioGeneration}}
                <span class="feature-badge apprentice" title="Requires Apprentice tier or higher">
                    <i class="fas fa-lock"></i> Apprentice
                </span>
            {{/unless}}
        </label>
        <div class="input-with-ai">
            <textarea id="npc-biography" name="biography" rows="6" placeholder="Enter NPC biography"></textarea>
            {{#if aiEnabled}}
            <button type="button" class="ai-assist-btn {{#unless hasBioGeneration}}locked{{/unless}}" data-ai-action="generateBio" title="{{#if hasBioGeneration}}Generate Biography{{else}}Requires Apprentice tier{{/if}}">
                <i class="fas fa-wand-magic-sparkles"></i>
            </button>
            {{/if}}
        </div>
    </div>

    <!-- Portrait -->
    <div class="form-group">
        <label for="npc-portrait">
            Portrait (Optional)
            {{#unless hasPortraitGeneration}}
                <span class="feature-badge wizard" title="Requires Wizard tier">
                    <i class="fas fa-lock"></i> Wizard
                </span>
            {{/unless}}
        </label>
        <div class="file-input-group">
            <input type="text" id="npc-portrait" name="portrait" placeholder="Path to portrait image" />
            {{#if aiEnabled}}
            <button type="button" class="ai-assist-btn {{#unless hasPortraitGeneration}}locked{{/unless}}" data-ai-action="generatePortrait" title="{{#if hasPortraitGeneration}}Generate Portrait ($0.04){{else}}Requires Wizard tier{{/if}}">
                <i class="fas fa-wand-magic-sparkles"></i>
            </button>
            {{/if}}
            <button type="button" class="file-picker" data-type="image" data-target="portrait">
                <i class="fas fa-file-import"></i> Browse
            </button>
        </div>
        <div class="image-preview" data-preview="portrait">
            <img src="" alt="Portrait Preview" style="display: none; max-width: 100px; max-height: 100px; margin-top: 5px;" />
        </div>
    </div>

    <!-- Token -->
    <div class="form-group">
        <label for="npc-token">Token (Optional)</label>
        <div class="file-input-group">
            <input type="text" id="npc-token" name="token" placeholder="Path to token image" />
            <button type="button" class="file-picker" data-type="image" data-target="token">
                <i class="fas fa-file-import"></i> Browse
            </button>
        </div>
        <div class="image-preview" data-preview="token">
            <img src="" alt="Token Preview" style="display: none; max-width: 100px; max-height: 100px; margin-top: 5px;" />
        </div>
    </div>

    <footer class="form-footer flexrow">
        <button type="button" data-action="create" class="bright">
            <i class="fas fa-check"></i> Create NPC
        </button>
        <button type="button" data-action="cancel">
            <i class="fas fa-times"></i> Cancel
        </button>
    </footer>
</div>
